document.addEventListener("DOMContentLoaded", () => {
    let selectedFestival = null;
    let selectedHoliday = null;
    let selectedRating = 0;
    let isSpeaking = false;

    // --- MULTILINGUAL FEATURE ---
    const translations = {
        en: {
            nav_home: 'Home',
            nav_features: 'Features',
            nav_ai_planner: 'AI Planner',
            nav_tts: 'Text to Speech',
            nav_explore: 'Explore',
            nav_top_destinations: 'Top destinations',
            nav_indian_delicacy: 'Indian Delicacy',
            nav_filter: 'Filter',
            nav_language: 'Language',
            hero_quote: 'Discover Beautiful Destinations',
            search_placeholder: 'üîç Enter destination city...',
            plan_trip_btn: '‚úàÔ∏è Plan Your Trip',
            filter_duration: 'Duration',
            filter_to: 'to',
            filter_festive: 'Festive Season',
            filter_holiday: 'Holiday',
            filter_yes: 'Yes',
            filter_no: 'No',
            filter_rating: 'Hotel Rating',
            get_predictions_btn: 'üîÆ Get Predictions',
            // ... (add all other English translations)
        },
        hi: {
            nav_home: '‡§π‡•ã‡§Æ',
            nav_features: '‡§µ‡§ø‡§∂‡•á‡§∑‡§§‡§æ‡§è‡§Å',
            nav_ai_planner: '‡§è‡§Ü‡§à ‡§™‡•ç‡§≤‡§æ‡§®‡§∞',
            nav_tts: '‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§ü‡•Ç ‡§∏‡•ç‡§™‡•Ä‡§ö',
            nav_explore: '‡§Ö‡§®‡•ç‡§µ‡•á‡§∑‡§£ ‡§ï‡§∞‡•á‡§Ç',
            nav_top_destinations: '‡§∂‡•Ä‡§∞‡•ç‡§∑ ‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø',
            nav_indian_delicacy: '‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§µ‡•ç‡§Ø‡§Ç‡§ú‡§®',
            nav_filter: '‡§´‡§º‡§ø‡§≤‡•ç‡§ü‡§∞',
            nav_language: '‡§≠‡§æ‡§∑‡§æ',
            hero_quote: '‡§∏‡•Å‡§Ç‡§¶‡§∞ ‡§∏‡•ç‡§•‡§≤‡•ã‡§Ç ‡§ï‡•Ä ‡§ñ‡•ã‡§ú ‡§ï‡§∞‡•á‡§Ç',
            search_placeholder: 'üîç ‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø ‡§∂‡§π‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç...',
            plan_trip_btn: '‚úàÔ∏è ‡§Ö‡§™‡§®‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç',
            filter_duration: '‡§Ö‡§µ‡§ß‡§ø',
            filter_to: '‡§§‡§ï',
            filter_festive: '‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞ ‡§ï‡§æ ‡§Æ‡•å‡§∏‡§Æ',
            filter_holiday: '‡§õ‡•Å‡§ü‡•ç‡§ü‡•Ä',
            filter_yes: '‡§π‡§æ‡§Å',
            filter_no: '‡§®‡§π‡•Ä‡§Ç',
            filter_rating: '‡§π‡•ã‡§ü‡§≤ ‡§∞‡•á‡§ü‡§ø‡§Ç‡§ó',
            get_predictions_btn: 'üîÆ ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡§ø‡§Ø‡§æ‡§Å ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç',
             // ... (add all other Hindi translations)
        },
        mr: {
            nav_home: '‡§Æ‡•Å‡§ñ‡•ç‡§Ø‡§™‡•É‡§∑‡•ç‡§†',
            nav_features: '‡§µ‡•à‡§∂‡§ø‡§∑‡•ç‡§ü‡•ç‡§Ø‡•á',
            nav_ai_planner: '‡§è‡§Ü‡§Ø ‡§™‡•ç‡§≤‡•Ö‡§®‡§∞',
            nav_tts: '‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§ü‡•Ç ‡§∏‡•ç‡§™‡•Ä‡§ö',
            nav_explore: '‡§Ö‡§®‡•ç‡§µ‡•á‡§∑‡§£ ‡§ï‡§∞‡§æ',
            nav_top_destinations: '‡§∂‡•Ä‡§∞‡•ç‡§∑ ‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø‡•á',
            nav_indian_delicacy: '‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§∏‡•ç‡§µ‡§æ‡§¶‡§ø‡§∑‡•ç‡§ü ‡§™‡§¶‡§æ‡§∞‡•ç‡§•',
            nav_filter: '‡§´‡§ø‡§≤‡•ç‡§ü‡§∞',
            nav_language: '‡§≠‡§æ‡§∑‡§æ',
            hero_quote: '‡§∏‡•Å‡§Ç‡§¶‡§∞ ‡§∏‡•ç‡§•‡§≥‡§æ‡§Ç‡§ö‡§æ ‡§∂‡•ã‡§ß ‡§ò‡•ç‡§Ø‡§æ',
            search_placeholder: 'üîç ‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø ‡§∂‡§π‡§∞ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§æ...',
            plan_trip_btn: '‚úàÔ∏è ‡§Ü‡§™‡§≤‡•ç‡§Ø‡§æ ‡§∏‡§π‡§≤‡•Ä‡§ö‡•Ä ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡§∞‡§æ',
            filter_duration: '‡§ï‡§æ‡§≤‡§æ‡§µ‡§ß‡•Ä',
            filter_to: '‡§™‡§∞‡•ç‡§Ø‡§Ç‡§§',
            filter_festive: '‡§∏‡§£‡§æ‡§∏‡•Å‡§¶‡•Ä‡§ö‡§æ ‡§π‡§Ç‡§ó‡§æ‡§Æ',
            filter_holiday: '‡§∏‡•Å‡§ü‡•ç‡§ü‡•Ä',
            filter_yes: '‡§π‡•ã‡§Ø',
            filter_no: '‡§®‡§æ‡§π‡•Ä',
            filter_rating: '‡§π‡•â‡§ü‡•á‡§≤ ‡§∞‡•á‡§ü‡§ø‡§Ç‡§ó',
            get_predictions_btn: 'üîÆ ‡§Ö‡§Ç‡§¶‡§æ‡§ú ‡§Æ‡§ø‡§≥‡§µ‡§æ',
             // ... (add all other Marathi translations)
        },
        es: {
            nav_home: 'Inicio',
            nav_features: 'Caracter√≠sticas',
            nav_ai_planner: 'Planificador de IA',
            nav_tts: 'Texto a voz',
            nav_explore: 'Explorar',
            nav_top_destinations: 'Mejores destinos',
            nav_indian_delicacy: 'Delicadeza india',
            nav_filter: 'Filtro',
            nav_language: 'Idioma',
            hero_quote: 'Descubre Destinos Hermosos',
            search_placeholder: 'üîç Ingrese la ciudad de destino...',
            plan_trip_btn: '‚úàÔ∏è Planifica Tu Viaje',
            filter_duration: 'Duraci√≥n',
            filter_to: 'a',
            filter_festive: 'Temporada festiva',
            filter_holiday: 'Feriado',
            filter_yes: 'S√≠',
            filter_no: 'No',
            filter_rating: 'Calificaci√≥n del hotel',
            get_predictions_btn: 'üîÆ Obtener Predicciones',
             // ... (add all other Spanish translations)
        }
    };

    const setLanguage = (lang) => {
        document.querySelectorAll('[data-translate]').forEach(element => {
            const key = element.getAttribute('data-translate');
            if (translations[lang] && translations[lang][key]) {
                if (element.placeholder) {
                    element.placeholder = translations[lang][key];
                } else {
                    element.innerHTML = translations[lang][key];
                }
            }
        });
        localStorage.setItem('language', lang); // Save language choice
    };

    document.querySelectorAll('.lang-switcher').forEach(button => {
        button.addEventListener('click', (event) => {
            event.preventDefault();
            const selectedLang = event.target.getAttribute('data-lang');
            setLanguage(selectedLang);
        });
    });

    const savedLanguage = localStorage.getItem('language') || 'en';
    setLanguage(savedLanguage);

    // --- TEXT-TO-SPEECH (TTS) FEATURE ---
    const ttsButton = document.getElementById('text-to-speech-btn');
    ttsButton.addEventListener('click', (e) => {
        e.preventDefault();
        if (isSpeaking) {
            window.speechSynthesis.cancel();
            isSpeaking = false;
        } else {
            let textToSpeak = '';
            document.querySelectorAll('[data-translate]').forEach(el => {
                textToSpeak += el.innerText + '. ';
            });
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = localStorage.getItem('language') || 'en';
            utterance.onend = () => {
                isSpeaking = false;
            };
            window.speechSynthesis.speak(utterance);
            isSpeaking = true;
        }
    });

    // --- THEME TOGGLE ---
    const themeToggle = document.getElementById("theme-toggle");
    if (localStorage.getItem("theme") === "dark") {
        document.body.classList.add("dark");
        themeToggle.textContent = "‚òÄÔ∏è";
    }
    themeToggle.addEventListener("click", () => {
        document.body.classList.toggle("dark");
        const dark = document.body.classList.contains("dark");
        themeToggle.textContent = dark ? "‚òÄÔ∏è" : "üåô";
        localStorage.setItem("theme", dark ? "dark" : "light");
    });

    // --- CHATBOT FUNCTIONALITY ---
    const chatBtn = document.getElementById("chatbot-btn");
    const chatPop = document.getElementById("chatbot-popup");
    const closeChatbotBtn = document.getElementById("close-chatbot");
    const sendChatBtn = document.getElementById("chatbot-send-btn");
    const chatInputField = document.getElementById("chatbot-input-field");
    const chatMessages = document.getElementById("chatbot-messages");
    const aiPlannerBtn = document.getElementById("ai-planner-btn"); // Get AI Planner button

    const toggleChatbot = () => {
        const isVisible = chatPop.style.display === "flex";
        chatPop.style.display = isVisible ? "none" : "flex";
    };

    chatBtn.addEventListener("click", toggleChatbot);
    closeChatbotBtn.addEventListener("click", toggleChatbot);
    
    // Event listener for AI Planner button to open chatbot
    aiPlannerBtn.addEventListener("click", (e) => {
        e.preventDefault();
        toggleChatbot();
    });

    const appendMessage = (text, sender) => {
        const messageElement = document.createElement('div');
        messageElement.classList.add('chat-message', `${sender}-message`);
        messageElement.textContent = text;
        chatMessages.appendChild(messageElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    };

    const handleSendMessage = () => {
        const userText = chatInputField.value.trim();
        if (userText === '') return;
        appendMessage(userText, 'user');
        chatInputField.value = '';
        setTimeout(() => {
            const botResponse = "This is a simulated response. Full functionality requires a backend.";
            appendMessage(botResponse, 'bot');
        }, 600);
    };

    sendChatBtn.addEventListener("click", handleSendMessage);
    chatInputField.addEventListener("keypress", (e) => {
        if (e.key === 'Enter') {
            handleSendMessage();
        }
    });

    // --- HERO SLIDER ---
    const heroBgs = document.querySelectorAll(".hero-bg");
    const heroQuote = document.getElementById("hero-quote");
    const quotes = {
        en: ["Discover Beautiful Destinations", "Explore the Wonders of India", "Adventure Awaits You", "Taste Local Cuisines"],
        hi: ["‡§∏‡•Å‡§Ç‡§¶‡§∞ ‡§∏‡•ç‡§•‡§≤‡•ã‡§Ç ‡§ï‡•Ä ‡§ñ‡•ã‡§ú ‡§ï‡§∞‡•á‡§Ç", "‡§≠‡§æ‡§∞‡§§ ‡§ï‡•á ‡§Ö‡§ú‡•Ç‡§¨‡•ã‡§Ç ‡§ï‡•ã ‡§ñ‡•ã‡§ú‡•á‡§Ç", "‡§∏‡§æ‡§π‡§∏‡§ø‡§ï ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§Ü‡§™‡§ï‡•ã ‡§¨‡•Å‡§≤‡§æ ‡§∞‡§π‡§æ ‡§π‡•à", "‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§µ‡•ç‡§Ø‡§Ç‡§ú‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§¶ ‡§≤‡•á‡§Ç"],
        mr: ["‡§∏‡•Å‡§Ç‡§¶‡§∞ ‡§∏‡•ç‡§•‡§≥‡§æ‡§Ç‡§ö‡§æ ‡§∂‡•ã‡§ß ‡§ò‡•ç‡§Ø‡§æ", "‡§≠‡§æ‡§∞‡§§‡§æ‡§ö‡•ç‡§Ø‡§æ ‡§Ü‡§∂‡•ç‡§ö‡§∞‡•ç‡§Ø‡§æ‡§Ç‡§ö‡§æ ‡§∂‡•ã‡§ß ‡§ò‡•ç‡§Ø‡§æ", "‡§∏‡§æ‡§π‡§∏ ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§µ‡§æ‡§ü ‡§™‡§æ‡§π‡§§ ‡§Ü‡§π‡•á", "‡§∏‡•ç‡§•‡§æ‡§®‡§ø‡§ï ‡§™‡§¶‡§æ‡§∞‡•ç‡§•‡§æ‡§Ç‡§ö‡•Ä ‡§ö‡§µ ‡§ò‡•ç‡§Ø‡§æ"],
        es: ["Descubre Destinos Hermosos", "Explora las Maravillas de la India", "La Aventura te Espera", "Prueba las Cocinas Locales"]
    };

    let index = 0;

    function nextHero() {
        if (heroBgs.length === 0) return;
        heroBgs.forEach(bg => bg.classList.remove("active"));
        heroBgs[index].classList.add("active");

        const currentLang = localStorage.getItem('language') || 'en';
        const currentQuotes = quotes[currentLang];

        heroQuote.style.opacity = 0;
        setTimeout(() => {
            heroQuote.textContent = currentQuotes[index];
            heroQuote.style.opacity = 1;
        }, 500);
        index = (index + 1) % heroBgs.length;
    }
    nextHero();
    setInterval(nextHero, 4000);
    
    // --- SCROLL REVEAL ---
    const revealEls = document.querySelectorAll(".section,.card,.food-card");

    function reveal() {
        const trig = window.innerHeight * 0.85;
        revealEls.forEach(el => {
            if (el.getBoundingClientRect().top < trig) {
                el.classList.add("show");
            }
        });
    }
    window.addEventListener("scroll", reveal);
    reveal();

    // --- STAR RATING ---
    const stars = document.querySelectorAll(".star-rating span");
    const ratingContainer = document.querySelector(".star-rating");
    stars.forEach((star, index) => {
        star.addEventListener("mouseover", () => {
            stars.forEach((s, i) => s.classList.toggle("hovered", i <= index));
        });
        star.addEventListener("click", () => {
            selectedRating = index + 1;
            stars.forEach((s, i) => {
                s.classList.remove("hovered");
                s.classList.toggle("selected", i < selectedRating);
            });
        });
    });
    ratingContainer.addEventListener("mouseout", () => {
        stars.forEach(s => s.classList.remove("hovered"));
        stars.forEach((s, i) => {
            s.classList.toggle("selected", i < selectedRating);
        });
    });

    // --- FILTER CONTROLS ---
    document.querySelectorAll('.filter-dropdown').forEach(dropdown => {
        const valueSpan = dropdown.querySelector('.selected-value');
        if (!valueSpan) return;
        dropdown.querySelectorAll('.option-yn').forEach(option => {
            option.addEventListener('click', (e) => {
                e.preventDefault();
                const selectedValue = option.getAttribute('data-value');
                const dataType = option.getAttribute('data-type');

                const currentLang = localStorage.getItem('language') || 'en';
                const translatedYes = translations[currentLang]['filter_yes'];
                const translatedNo = translations[currentLang]['filter_no'];

                valueSpan.textContent = `: ${selectedValue === 'Yes' ? translatedYes : translatedNo}`;

                if (dataType === 'festival') selectedFestival = selectedValue;
                else if (dataType === 'holiday') selectedHoliday = selectedValue;
            });
        });
    });

    // --- PREDICTION LOGIC ---
    const predictionBtn = document.getElementById('prediction-btn');
    const planTripBtn = document.getElementById('plan-trip-btn');
    const getPredictions = () => {
        const destination = document.getElementById('destination-input').value.trim();
        if (!destination || !selectedFestival || !selectedHoliday || selectedRating === 0) {
            alert('Please fill in all fields: Destination, Festive Season, Holiday, and Hotel Rating.');
            return;
        }
        alert(`Getting predictions for ${destination}...\nThis is a front-end demonstration. A backend is needed for real predictions.`);
    };
    predictionBtn.addEventListener('click', getPredictions);
    planTripBtn.addEventListener('click', getPredictions);
});
